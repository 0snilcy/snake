(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],[,,,,,,,,,,,,function(t,e,i){},,,,function(t,e,i){},,function(t,e,i){},function(t,e,i){},function(t,e,i){},function(t,e,i){"use strict";i.r(e);var n,s,r,c,a,o,h=i(1),u=i.n(h),d=(i(12),i(8)),j=i.n(d),l=i(3),f=(i(16),i(2)),p=i(6),b=i(9),m=i(10);!function(t){t[t.Welcome=0]="Welcome",t[t.Action=1]="Action",t[t.Win=2]="Win",t[t.Lose=3]="Lose"}(r||(r={})),function(t){t[t.Wait=0]="Wait",t[t.Action=1]="Action",t[t.Lose=2]="Lose",t[t.Win=3]="Win"}(c||(c={})),function(t){t[t.Empty=0]="Empty",t[t.Snake=1]="Snake",t[t.Fruit=2]="Fruit"}(a||(a={})),function(t){t[t.Up=0]="Up",t[t.Down=1]="Down",t[t.Right=2]="Right",t[t.Left=3]="Left"}(o||(o={}));var O={ArrowUp:o.Up,ArrowDown:o.Down,ArrowRight:o.Right,ArrowLeft:o.Left},S=(n={},Object(f.a)(n,o.Up,o.Down),Object(f.a)(n,o.Down,o.Up),Object(f.a)(n,o.Left,o.Right),Object(f.a)(n,o.Right,o.Left),n),g=(s={},Object(f.a)(s,o.Up,-1),Object(f.a)(s,o.Down,1),Object(f.a)(s,o.Left,-1),Object(f.a)(s,o.Right,1),s),v=function(t){return Array(t).fill("").map((function(){return a.Empty}))},x=function(t){return Math.floor(Math.random()*t)},k=function(){function t(e){var i=this,n=e.updateState,s=e.updateGrid,r=e.minSpeed,a=e.maxSpeed,o=e.gridSize;Object(b.a)(this,t),this.pointShift=100,this.size=void 0,this.snake=void 0,this.fruits=void 0,this.lastDirection=null,this.state=c.Wait,this.score=0,this.currentSpeed=void 0,this.maxSpeed=void 0,this.minSpeed=void 0,this.speedStep=void 0,this.timer=null,this.changeState=void 0,this.updateGrid=void 0,this.changeState=function(t){n(t),i.state=t},this.updateGrid=function(){s(i.grid)},this.minSpeed=r,this.maxSpeed=a,this.currentSpeed=r,this.speedStep=Math.round((r-a)/Math.pow(o,2)),this.size=o,this.snake=[this.getPoint(Math.floor(this.size/2),Math.floor(this.size/2))],this.fruits=[this.getFruit()]}return Object(m.a)(t,[{key:"grid",get:function(){var t=this,e=v(this.size).map((function(){return v(t.size)}));if(![c.Wait,c.Action].includes(this.state))return e;var i,n=Object(p.a)(this.snake);try{for(n.s();!(i=n.n()).done;){var s=i.value,r=this.getArrFromPoint(s);e[r[0]][r[1]]=a.Snake}}catch(j){n.e(j)}finally{n.f()}var o,h=Object(p.a)(this.fruits);try{for(h.s();!(o=h.n()).done;){var u=o.value,d=this.getArrFromPoint(u);e[d[0]][d[1]]=a.Fruit}}catch(j){h.e(j)}finally{h.f()}return e}},{key:"getPoint",value:function(t,e){return t*this.pointShift+e}},{key:"getArrFromPoint",value:function(t){return[Math.floor(t/this.pointShift),Math.round(t/this.pointShift%1*this.pointShift)]}},{key:"checkGameStatus",value:function(){var t=this.getArrFromPoint(this.snake[0]);(t[0]<0||t[0]>this.size-1||t[1]<0||t[1]>this.size-1)&&this.changeState(c.Lose)}},{key:"shift",value:function(t){var e=this.snake[0];if(t===o.Up||t===o.Down?e+=g[t]*this.pointShift:t!==o.Left&&t!==o.Right||(e+=g[t]),this.snake.includes(e))this.changeState(c.Lose);else{this.snake.unshift(e);var i=this.fruits.length;if(this.fruits=this.fruits.filter((function(t){return t!==e})),i===this.fruits.length)this.snake.pop();else{if(this.snake.length===Math.pow(this.size,2))return this.changeState(c.Win);this.score+=1,this.currentSpeed=this.minSpeed-(this.snake.length-1)*this.speedStep,this.fruits.push(this.getFruit())}this.lastDirection=t,this.checkGameStatus()}}},{key:"setTimer",value:function(t){var e=this;this.timer&&clearTimeout(this.timer),this.timer=setTimeout((function(){e.shift(t),e.updateGrid(),[c.Wait,c.Action].includes(e.state)&&e.setTimer(t)}),200)}},{key:"getFruit",value:function(){var t;do{t=this.getPoint(x(this.size),x(this.size))}while(~this.snake.indexOf(t));return t}},{key:"move",value:function(t){[c.Wait,c.Action].includes(this.state)&&this.lastDirection&&(t===this.lastDirection||t===S[this.lastDirection])||(this.shift(t),this.setTimer(t))}}]),t}(),y=i(7),z=i(0),w={debug:!1,minSpeed:1e3,maxSpeed:200,gridSize:9,setDebug:function(){},setGridSize:function(){}},W=u.a.createContext(w),A=function(t){var e=t.children,i=Object(h.useState)(w.debug),n=Object(l.a)(i,2),s=n[0],r=n[1],c=Object(h.useState)(w.gridSize),a=Object(l.a)(c,2),o=a[0],u=a[1],d=Object(y.a)(Object(y.a)({},w),{},{debug:s,setDebug:r,gridSize:o,setGridSize:u});return Object(z.jsx)(W.Provider,{value:d,children:e})},D=function(){return Object(h.useContext)(W)},L=(i(18),function(t){var e=t.speed,i=t.score,n=t.speedStep,s=D(),r=s.debug,c=s.setDebug,a=s.minSpeed,o=s.maxSpeed,h=s.gridSize;return Object(z.jsxs)("section",{className:"controls",children:[Object(z.jsx)("h2",{children:"State"}),Object(z.jsx)("p",{children:Object(z.jsxs)("label",{children:["Debug:",Object(z.jsx)("input",{type:"checkbox",checked:r,onChange:function(){return c((function(t){return!t}))}})]})}),Object(z.jsxs)("p",{children:["Score: ",i]}),Object(z.jsxs)("p",{children:["Grid size: ",h]}),Object(z.jsxs)("p",{children:["Cell length: ",Math.pow(h,2)]}),Object(z.jsxs)("dl",{children:[Object(z.jsx)("dt",{children:"Speed"}),Object(z.jsxs)("dd",{children:["current: ",e,"ms"]}),Object(z.jsxs)("dd",{children:["step: ",n,"ms"]}),Object(z.jsxs)("dd",{children:["min: ",a,"ms"]}),Object(z.jsxs)("dd",{children:["max: ",o,"ms"]})]})]})}),G=(i(19),["",Object(z.jsx)("div",{className:"snake"}),"\ud83e\udd51"]),F=Object(h.memo)((function(t){var e=t.type,i=function(){var t=D();return{debug:t.debug,setDebug:t.setDebug}}().debug;return Object(z.jsx)("div",{className:"cell",children:i?e:G[e]})})),M=(i(20),Object(h.memo)((function(t){var e=t.list;return Object(z.jsx)("div",{className:"row",children:e.map((function(t,e){return Object(z.jsx)(F,{type:t},e)}))})}))),P=Object(h.memo)((function(t){var e=t.grid;return Object(z.jsx)("div",{className:"grid",children:e.map((function(t,e){return Object(z.jsx)(M,{list:t},e)}))})})),R=function(t){var e;return(e={},Object(f.a)(e,c.Lose,Object(z.jsx)("h2",{children:"Game over: Lose \ud83d\ude40"})),Object(f.a)(e,c.Win,Object(z.jsx)("h2",{children:"Game over: Win \ud83c\udf89"})),e)[t]},U=function(){var t=Object(h.useState)([[]]),e=Object(l.a)(t,2),i=e[0],n=e[1],s=Object(h.useState)(null),r=Object(l.a)(s,2),a=r[0],o=r[1],u=Object(h.useState)(c.Wait),d=Object(l.a)(u,2),j=d[0],f=d[1],p=D(),b=p.maxSpeed,m=p.minSpeed,S=p.gridSize;return Object(h.useEffect)((function(){var t=function(t){var e=t.key;j===c.Wait&&f(c.Action),e in O&&a&&(a.move(O[e]),n(a.grid))};if(j===c.Wait&&!a){var e=new k({updateState:f,updateGrid:n,maxSpeed:b,minSpeed:m,gridSize:S});o(e),n(e.grid)}return[c.Wait,c.Action].includes(j)&&document.addEventListener("keydown",t),function(){return document.removeEventListener("keydown",t)}}),[j,a,b,m,S]),Object(z.jsxs)("div",{children:[Object(z.jsx)("h2",{children:"Snake"}),Object(z.jsx)("div",{className:"row-container",children:[c.Wait,c.Action].includes(j)?Object(z.jsx)(P,{grid:i}):R(j)}),a&&Object(z.jsx)(L,{score:a.score,speed:a.currentSpeed,speedStep:a.speedStep})]})},E=function(){var t=D(),e=t.gridSize,i=t.setGridSize,n=Object(h.useState)(e),s=Object(l.a)(n,2),r=s[0],c=s[1],a=Object(h.useState)(!1),o=Object(l.a)(a,2),u=o[0],d=o[1];return Object(z.jsx)("section",{className:"app",children:u?Object(z.jsx)(U,{}):Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)("h2",{children:"Welcome"}),Object(z.jsxs)("p",{children:["Grid size: ",r,"x",r]}),Object(z.jsx)("input",{type:"range",min:"3",max:"27",step:"2",defaultValue:r,onChange:function(t){var e=t.target;c(+e.value)}}),Object(z.jsx)("button",{type:"button",onClick:function(){i(r),d(!0)},children:"Start"})]})})};j.a.render(Object(z.jsx)(u.a.StrictMode,{children:Object(z.jsx)(A,{children:Object(z.jsx)(E,{})})}),document.getElementById("root"))}],[[21,1,2]]]);
//# sourceMappingURL=main.876e39f5.chunk.js.map